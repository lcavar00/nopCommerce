@model Nop.Plugin.Shipping.DPD.Models.ConfigurationModel
@using Nop.Web.Framework.Models.AdminAreaTour

@{
    Layout = "_ConfigurePlugin";

    //tour step
    ViewBag.TourStep = TourStep.TaxManual;
}

@await Html.PartialAsync("_AdminTour")

@if (!Model.AvailableShippingMethods.Any())
{
    <div class="form-group row">
        <div class="col-md-3">
            <h3>@T("Plugins.Shipping.Core.Warning.NoShippingMethods")</h3>
            <p>@T("Plugins.Shipping.Core.ConfigureShippingMethods")</p>
        </div>
        <div class="col-md-9">
            <div class="float-right">
                <a asp-controller="Shipping" asp-action="Methods" class="btn bg-blue">
                    <i class="fa fa-truck"></i>
                    @T("Admin.Configuration.Shipping.Methods.Manage")
                </a>
                <a asp-controller="Shipping" asp-action="Restrictions" class="btn bg-blue">
                    <i class="fa fa-globe"></i>
                    @T("Admin.Configuration.Shipping.Restrictions")
                </a>
                <a asp-controller="DPDPlugin" asp-action="ApiConfiguration" class="btn bg-blue">
                    <i class="fa fa-globe"></i>
                    API
                </a>
            </div>
        </div>
    </div>
}
else
{
    <div class="form-group row">
        <div class="col-md-3">
            <div class="onoffswitch">
                <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="advanced-settings-mode" checked="@Model.ShippingByTotalByLocationEnabled">
                <label class="onoffswitch-label" for="advanced-settings-mode">
                    <span class="onoffswitch-inner"
                          data-locale-basic="@T("Plugins.Shipping.Core.Fixed")"
                          data-locale-advanced="@T("Plugins.Shipping.Core.ShippingByTotal")"></span>
                    <span class="onoffswitch-switch"></span>
                </label>
            </div>
        </div>
        <div class="col-md-9">
            <div class="float-right">
                <a asp-controller="Shipping" asp-action="Methods" class="btn bg-blue">
                    <i class="fa fa-truck"></i>
                    @T("Admin.Configuration.Shipping.Methods.Manage")
                </a>
                <a asp-controller="Shipping" asp-action="Restrictions" class="btn bg-blue">
                    <i class="fa fa-globe"></i>
                    @T("Admin.Configuration.Shipping.Restrictions")
                </a>
                <a asp-controller="DPDPlugin" asp-action="ApiConfiguration" class="btn bg-blue">
                    <i class="fa fa-globe"></i>
                    API
                </a>
            </div>
        </div>
    </div>

    <script>
    function checkAdvancedSettingsMode(advanced) {
        if (advanced) {
            $("body").addClass("advanced-settings-mode");
            $("body").removeClass("basic-settings-mode");
        } else {
            $("body").removeClass("advanced-settings-mode");
            $("body").addClass("basic-settings-mode");
        }
    }

    checkAdvancedSettingsMode($("#advanced-settings-mode").is(':checked'));
    $(document)
        .ready(function() {
            $("#advanced-settings-mode")
                .click(function() {
                    checkAdvancedSettingsMode($(this).is(':checked'));
                    $.ajax({
                        cache: false,
                        url: "@Url.Action("SaveMode", "DPDPlugin")",
                        type: "POST",
                        data: {
                            value: $(this).is(':checked')
                        },
                        dataType: "json",
                        error: function (jqXHR, textStatus, errorThrown) {
                            $("#saveModeAlert").click();
                        }
                    });
                    ensureDataTablesRendered();
                });
        });
    </script>
    <nop-alert asp-alert-id="saveModeAlert" asp-alert-message="@T("Admin.Common.Alert.Save.Error")" />

    @await Html.PartialAsync("~/Plugins/Shipping.DPD/Views/_FixedRate.cshtml", Model)
    @await Html.PartialAsync("~/Plugins/Shipping.DPD/Views/_ByLocationByTotalByWeight.cshtml", Model)
}

